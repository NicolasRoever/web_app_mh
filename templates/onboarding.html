<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Install to Home Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="stylesheet" href="/static/styles.css" />

</head>
<body>
  <div class="screen">
    <header class="topbar">
      <h1 class="title">Add to Home Screen</h1>
      <p class="subtitle">Follow these quick steps to get the app-like experience.</p>
    </header>

    <main class="content">
      <section class="card">
        <div id="iosTip" class="tip hide">
          <ol class="steps">
            <li>
              <div class="step-badge">1</div>
              <div class="step-copy">
                Tap the <strong>Share</strong> button in your browserâ€™s toolbar.
                <figure class="shot">
                  <picture>
                    <img
                      src="{{ url_for('static', filename='images/Upload_Step_1.jpeg') }}"
                      alt="iOS Safari share button highlighted"
                      loading="eager"
                      decoding="async"
                      class="shot-img"
                    />
                  </picture>
                  <figcaption class="shot-cap">The Share icon (square with an arrow).</figcaption>
                </figure>
              </div>
            </li>
            <li>
              <div class="step-badge">2</div>
              <div class="step-copy">
                Choose <strong>Add to Home Screen</strong> and confirm.
                <figure class="shot">
                  <picture>
                    <img
                      src="/static/images/Upload_step_2.jpeg"
                      alt="Add to Home Screen option in the iOS share sheet"
                      loading="lazy"
                      decoding="async"
                      class="shot-img"
                    />
                  </picture>
                  <figcaption class="shot-cap">Then open the new icon to continue the study.</figcaption>
                </figure>
              </div>
            </li>
          </ol>
          <p class="hint">Works in Safari and Chrome on iPhone/iPad.</p>
        </div>

        <div class="cta-row">
          <button class="btn ghost" type="button" onclick="skip()">Skip for now</button>
          <button class="btn primary" type="button" onclick="openApp()">Open app now</button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Minimal iOS + standalone detection
    const ua = navigator.userAgent || '';
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;

    // If already installed/launched from icon, go straight to the app.
    if (isStandalone) {
      location.replace('/content');
    } else {
      // Show the iOS tip only on iOS browsers
      if (isIOS) {
        document.getElementById('iosTip').classList.remove('hide');
      } else {
        // Non-iOS fallback: still allow users to proceed
        document.querySelector('.subtitle').textContent = 'You can proceed to the app.';
        document.getElementById('iosTip').classList.add('hide');
      }
    }

    function openApp() {
      location.href = '/content';
    }
    function skip() {
      location.href = '/content';
    }
  </script>
</body>
</html>
